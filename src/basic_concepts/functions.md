# 函数

## 函数定义

函数使用`fn`关键字定义，后跟函数名称和以圆括号`()`包裹的参数列表，然后是可选的以`->`开头的函数返回值类型声明，最后是以大括号`{}`包裹的函数体。

例如：

```rust
fn main() {
    let x = 1;
    println!("x = {}", x);
    let y = add_one(x);
    println!("add_one(x) = {}", y);
}

fn add_one(x: i32) -> i32 {
    x + 1
}
```

> `main`函数是大部分程序的入口点，这个例子中`main`函数调用了`add_one`函数。

函数定义中，除了函数体（function body）以外的部分称为函数的签名（signature），以`add_one`函数为例，其函数签名包括：

- `fn`：Rust语言的函数声明关键字。
- `add_one`：函数名。
- `(x: i32)`：此函数的参数列表。对应一个名为`x`的`i32`类型的值。
- `-> i32`：箭头指向的部分是此函数的返回值类型。这里是一个`i32`类型。

## 函数参数

函数签名中的参数列表称为形参（parameters），每个参数**必须声明类型**。

函数调用时的参数列表称为实参（arguments），参数类型需要与函数签名中声明的类型相匹配。

## 包含语句和表达式的函数体

函数体由一系列的语句和一个可选的结尾表达式构成。

**语句**（statements）是执行一些操作但不返回值的指令。

例如：

```rust
fn main() {
    let x = 1234;
    let y = x + 4321;
}
```

使用 `let` 关键字创建变量并绑定一个值是一个语句。函数定义也是一个语句。因此上述的整个例子本身就是一个语句。

**表达式**（Expressions）计算并产生一个值。

上述例子中，`1234`是一个表达式，其计算出的值是`1234`。`x + 4321`也是一个表达式，其计算出的值是`5555`。

函数调用、宏调用、用大括号`{}`包裹的代码块等都是表达式，例如：

```rust
fn main() {
    let x = 5;

    let y = {
        let x = 3;
        x + 1
    };

    println!("The value of y is: {}", y);
}
```

其中，这个表达式：

```rust,ignore
{
    let x = 3;
    x + 1
}
```

是一个代码块，对其进行计算得到的值是`4`。这个值作为`let`语句的一部分被绑定到变量`y`上。

> 代码块的最后一个表达式的值会作为代码块的值，因此这个代码块的值是表达式`x + 1`的值，注意表达式的结尾没有分号`;`。
>
> 如果在表达式的结尾加上分号，它就变成了语句，语句没有返回值。

## 函数的返回值

函数可以有返回值，也可以没有。

当函数有返回值时，在箭头（`->`）后声明函数返回值类型。

当不声明函数返回值类型时，函数默认返回空元组（`()`）类型。声明函数返回值类型为`()`与不声明函数返回值类型是等价的，都表示该函数没有返回值。

例如：

```rust
// 没有返回值
fn foo() {
    println!("foo");
}

// 返回空元组()，等价于没有返回值
fn bar() -> () {
    println!("bar");
}

fn main() {
	let foo_result = foo();
    println!("{:?}", foo_result);
    // #()

    let bar_result = bar();
    println!("{:?}", bar_result);
    // #()
}
```

一般来说，函数默认返回函数体最后一个表达式的值。也可以使用`return`关键字使函数提前返回。

函数的多个返回点所返回的值类型必须相同且符合函数签名中的类型定义。

例如：

```rust
/// 90分及以上：优秀
/// 60~89分：良好
/// 60分以下：一般
fn rating(score: u32) -> String {
    if score >= 90 {
        return String::from("Excellent");
    }
    if score >= 60 {
        return String::from("Good");
    }
    String::from("Normal")
}
```

